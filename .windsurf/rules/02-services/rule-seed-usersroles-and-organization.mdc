---
description: 
globs: 
alwaysApply: false
---
# R√®gle Seed - Utilisateurs, R√¥les et Organisations

## Vue d'ensemble

Cette r√®gle documente le jeu de test complet configur√© dans [seed.ts](mdc:src/db/scripts/seed.ts) pour couvrir tous les cas d'usage du syst√®me d'autorisation avec les r√¥les globaux et organisationnels.

## Architecture des R√¥les

### R√¥les Globaux (System-wide)
- **PUBLIC** : Utilisateur public avec acc√®s minimal
- **USER** : Utilisateur standard avec acc√®s limit√©
- **REDACTOR** : R√©dacteur avec permissions d'√©dition
- **MODERATOR** : Mod√©rateur avec permissions √©tendues
- **ADMIN** : Administrateur avec tous les privil√®ges
- **SUPER_ADMIN** : Super administrateur avec acc√®s total

### R√¥les Organisationnels
- **MEMBER** : Membre standard de l'organisation
- **ADMIN** : Administrateur de l'organisation
- **OWNER** : Propri√©taire de l'organisation

## Organisations de Test

| Slug | Nom | Description |
|------|-----|-------------|
| `techcorp-solutions` | TechCorp Solutions | Entreprise de d√©veloppement logiciel |
| `marketing-pro` | Marketing Pro | Agence de marketing digital |
| `acme-corp` | Acme Corp. | Startup innovante en technologie |
| `evil-corp` | Evil Corp. | Entreprise de cybers√©curit√© |

## Jeu de Test D√©taill√©

### üîê R√¥les Globaux Purs (sans organisations)

| Email | Nom | R√¥le Global | Usage |
|-------|-----|-------------|-------|
| `superadmin@gmail.com` | Frank | SUPER_ADMIN | Test bypass complet des permissions |
| `admin@gmail.com` | Admin | ADMIN | Test permissions administrateur syst√®me |
| `moderator@gmail.com` | David | MODERATOR | Test permissions mod√©rateur |
| `redactor@gmail.com` | Grace | REDACTOR | Test permissions r√©dacteur |
| `public@gmail.com` | Charlie | PUBLIC | Test acc√®s minimal |

**üéØ Cas d'usage** : Tester les permissions syst√®me globales, bypass organisationnel, acc√®s admin universel.

### üîÑ Utilisateur Multi-Organisations

| Email | Nom | R√¥le Global | TechCorp | Marketing Pro | Acme Corp | Evil Corp |
|-------|-----|-------------|----------|---------------|-----------|-----------|
| `user@gmail.com` | Bob | USER | MEMBER | - | ADMIN | OWNER |

**üéØ Cas d'usage** : Tester la progression des permissions (MEMBER ‚Üí ADMIN ‚Üí OWNER), contexte organisationnel variable, navigation entre organisations.

### üéØ Utilisateurs Sp√©cialis√©s (1 organisation = 1 r√¥le)

| Email | Nom | R√¥le Global | Organisation | R√¥le Org |
|-------|-----|-------------|--------------|----------|
| `user-owner@gmail.com` | Julien | USER | TechCorp | OWNER |
| `user-admin@gmail.com` | Sophie | USER | Marketing Pro | ADMIN |
| `user-member@gmail.com` | Lucas | USER | Acme Corp | MEMBER |

**üéØ Cas d'usage** : Tester les permissions pures par r√¥le organisationnel, isolation des contextes.

### ‚öñÔ∏è Cas de Chevauchement (R√¥le Global + Organisationnel)

| Email | Nom | R√¥le Global | Organisation | R√¥le Org |
|-------|-----|-------------|--------------|----------|
| `admin-owner@gmail.com` | Emma | ADMIN | Marketing Pro | OWNER |
| `moderator-member@gmail.com` | Julie | MODERATOR | TechCorp | MEMBER |

**üéØ Cas d'usage** : Tester la priorit√© des permissions (global vs organisationnel), permissions cumulatives.

### üèùÔ∏è Utilisateur Isol√©

| Email | Nom | R√¥le Global | Organisations |
|-------|-----|-------------|---------------|
| `user-isolated@gmail.com` | Thomas | USER | Aucune |

**üéØ Cas d'usage** : Tester les permissions sans contexte organisationnel, acc√®s limit√© aux ressources publiques.

### üëë Cas Sp√©ciaux Mike Codeur

| Email | Nom | R√¥le Global | Organisation | R√¥le Org |
|-------|-----|-------------|--------------|----------|
| `admin@mikecodeur.com` | Mike Codeur | ADMIN | TechCorp | OWNER |
| `ons@mikecodeur.com` | Ons | ADMIN | TechCorp | ADMIN |

**üéØ Cas d'usage** : Utilisateurs propri√©taires du syst√®me, permissions maximales.

## Sc√©narios de Test Recommand√©s

### 1. **Tests de Permissions Globales**
```typescript
// Utilisateurs √† tester
const globalUsers = [
  'superadmin@gmail.com',  // Acc√®s total
  'admin@gmail.com',       // Acc√®s admin
  'moderator@gmail.com',   // Acc√®s mod√©rateur
  'redactor@gmail.com',    // Acc√®s r√©dacteur
  'public@gmail.com'       // Acc√®s minimal
]
```

### 2. **Tests de Context Organisationnel**
```typescript
// user@gmail.com dans diff√©rentes organisations
const multiOrgTests = [
  { org: 'techcorp-solutions', role: 'MEMBER' },   // Permissions limit√©es
  { org: 'acme-corp', role: 'ADMIN' },            // Permissions √©tendues
  { org: 'evil-corp', role: 'OWNER' }             // Permissions maximales
]
```

### 3. **Tests de Chevauchement**
```typescript
// Test priorit√© des permissions
const overlapTests = [
  'admin-owner@gmail.com',      // ADMIN global + OWNER org
  'moderator-member@gmail.com'  // MODERATOR global + MEMBER org
]
```

### 4. **Tests d'Isolation**
```typescript
// Test utilisateur sans organisation
const isolationTest = 'user-isolated@gmail.com' // USER sans orgs
```

## Matrices de Test Sugg√©r√©es

### Test Matrix 1: Acc√®s aux Projets par Organisation
| Utilisateur | TechCorp | Marketing Pro | Acme Corp | Evil Corp |
|-------------|----------|---------------|-----------|-----------|
| `user@gmail.com` | Lecture seule | Aucun | √âcriture | Propri√©taire |
| `user-owner@gmail.com` | Propri√©taire | Aucun | Aucun | Aucun |
| `admin@gmail.com` | Bypass | Bypass | Bypass | Bypass |

### Test Matrix 2: Actions CRUD par R√¥le
| Action | MEMBER | ADMIN | OWNER | ADMIN Global |
|--------|--------|-------|-------|--------------|
| Cr√©er Projet | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ (bypass) |
| Modifier Projet | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ (bypass) |
| Supprimer Projet | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ (bypass) |
| G√©rer Membres | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ (bypass) |

## Commandes Utiles

### R√©initialiser la base avec le seed
```bash
pnpm run db:reset
pnpm run db:seed
```

### Connexion rapide pour tests
```bash
# Test avec diff√©rents utilisateurs
# Se connecter en tant que user@gmail.com pour tester multi-org
# Se connecter en tant que admin@gmail.com pour tester bypass
# Se connecter en tant que user-member@gmail.com pour tester limitations
```

## Points d'Attention

### üîç **√Ä V√©rifier lors des Tests**
1. **Isolation des organisations** : `user-member@gmail.com` ne doit voir que Acme Corp
2. **Progression des permissions** : `user@gmail.com` doit avoir des droits diff√©rents selon l'organisation
3. **Bypass global** : `admin@gmail.com` doit acc√©der √† tout sans appartenir √† une organisation
4. **Chevauchement** : `admin-owner@gmail.com` doit cumuler les permissions
5. **Isolation** : `user-isolated@gmail.com` ne doit voir aucune organisation priv√©e

### ‚ö†Ô∏è **Cas Limites √† Tester**
- Navigation entre organisations avec `user@gmail.com`
- Tentative d'acc√®s non autoris√© avec `user-member@gmail.com`
- Cr√©ation de ressources sans appartenance organisationnelle
- Actions sur des organisations non-membres

## Int√©gration avec l'Architecture

Ce jeu de test est con√ßu pour valider :
- ‚úÖ **Couche Service** : Validation et autorisation ([project-authorization.ts](mdc:src/services/authorization/project-authorization.ts))
- ‚úÖ **Couche DAL** : Cache et transformation des donn√©es ([project-dal.ts](mdc:src/app/dal/project-dal.ts))
- ‚úÖ **Couche Pr√©sentation** : Affichage conditionnel des composants ([projects-management.tsx](mdc:src/components/features/projects/projects-management.tsx))

Utilisez ce jeu de test pour valider end-to-end votre syst√®me d'autorisation multi-niveaux !
